name = "gameeval-qa-pipeline"
main = "src/index.ts"
compatibility_date = "2025-11-04"
compatibility_flags = ["nodejs_compat", "enable_ctx_exports"]
account_id = "a20259cba74e506296745f9c67c1f3bc"
workers_dev = false
assets = { directory = "dist/frontend", binding = "ASSETS" }

[[routes]]
pattern = "gameeval.adamwhite.work"
custom_domain = true

# Module aliases for Stagehand - Replace playwright with @cloudflare/playwright
# Based on: https://developers.cloudflare.com/browser-rendering/platform/stagehand/
[alias]
"playwright" = "@cloudflare/playwright"

[vars]
# R2_PUBLIC_URL points to the worker itself, which serves R2 files via /r2/ endpoint
# In local dev with `.dev.vars` file: wrangler dev ignores this and uses http://localhost:8787
# In production: uses the worker's production URL
R2_PUBLIC_URL = "https://evidence.adamwhite.work"

[observability]
enabled = true

# AI Gateway binding
[ai]
binding = "AI"
remote = true

# D1 Database binding
[[d1_databases]]
binding = "DB"
database_name = "gameeval-db"
database_id = "59b4298a-451e-4d40-ba24-82861f7f8721"

# R2 Bucket binding
[[r2_buckets]]
binding = "EVIDENCE_BUCKET"
bucket_name = "gameeval-evidence"

# Browser Rendering binding
[browser]
binding = "BROWSER"

# Workflows binding for orchestrating test pipelines
[[workflows]]
binding = "WORKFLOW"
name = "game-test-pipeline"
class_name = "GameTestPipeline"

# Durable Objects binding
[[durable_objects.bindings]]
name = "TEST_AGENT"
class_name = "TestAgentV2"
script_name = "gameeval-qa-pipeline"

# Durable Objects migrations
# v1: Original migration as deployed to production (non-SQLite)
[[migrations]]
tag = "v1"
new_classes = ["TestAgent"]

# v2: Create TestAgentV2 with SQLite support (TestAgent remains for backward compatibility)
[[migrations]]
tag = "v2"
new_sqlite_classes = ["TestAgentV2"]

# v3: Delete orphaned TestAgent class now that binding points to TestAgentV2
[[migrations]]
tag = "v3"
deleted_classes = ["TestAgent"]

